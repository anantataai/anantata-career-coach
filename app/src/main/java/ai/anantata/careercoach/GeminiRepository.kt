package ai.anantata.careercoach

import ai.anantata.careercoach.BuildConfig
import com.google.ai.client.generativeai.GenerativeModel
import com.google.ai.client.generativeai.type.generationConfig
import kotlinx.coroutines.flow.Flow
import kotlinx.coroutines.flow.flow

class GeminiRepository {

    // –ú–æ–¥–µ–ª—å –¥–ª—è —á–∞—Ç—É - —à–≤–∏–¥–∫–∞
    private val chatModel = GenerativeModel(
        modelName = "gemini-2.5-flash",
        apiKey = BuildConfig.GEMINI_API_KEY,
        generationConfig = generationConfig {
            temperature = 0.7f
            topK = 40
            topP = 0.95f
        }
    )

    // –ú–æ–¥–µ–ª—å –¥–ª—è Assessment - –±—ñ–ª—å—à –¥–µ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–∞ –¥–ª—è —Ç–æ—á–Ω–∏—Ö —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—ñ–≤
    private val assessmentModel = GenerativeModel(
        modelName = "gemini-2.5-flash",
        apiKey = BuildConfig.GEMINI_API_KEY,
        generationConfig = generationConfig {
            temperature = 0.3f  // –ó–ú–Ü–ù–ï–ù–û: –Ω–∏–∂—á–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–ª—è —Ç–æ—á–Ω—ñ—à–∏—Ö —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—ñ–≤
            topK = 40
            topP = 0.95f
            maxOutputTokens = 8192
        }
    )

    fun sendMessage(message: String): Flow<String> = flow {
        val response = chatModel.generateContentStream(message)
        response.collect { chunk ->
            emit(chunk.text ?: "")
        }
    }

    suspend fun generateAssessmentQuestions(
        type: String
    ): List<AssessmentQuestion> {
        return listOf(
            AssessmentQuestion(
                1,
                "–°–∫—ñ–ª—å–∫–∏ –≤–∞–º —Ä–æ–∫—ñ–≤?",
                "current_state",
                "select",
                listOf("–î–æ 25", "26-35", "36-45", "–ë—ñ–ª—å—à–µ 45")
            ),
            AssessmentQuestion(
                2,
                "–Ø–∫–∞ —É –≤–∞—Å –æ—Å–≤—ñ—Ç–∞?",
                "current_state",
                "select",
                listOf("–í–∏—â–∞ (–ë–∞–∫–∞–ª–∞–≤—Ä/–ú–∞–≥—ñ—Å—Ç—Ä)", "–ù–µ–ø–æ–≤–Ω–∞ –≤–∏—â–∞ (—Å—Ç—É–¥–µ–Ω—Ç)", "–°–µ—Ä–µ–¥–Ω—è —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∞", "–°–µ—Ä–µ–¥–Ω—è/–±–µ–∑ –æ—Å–≤—ñ—Ç–∏")
            ),
            AssessmentQuestion(
                3,
                "–Ø–∫–∞ –≤–∞—à–∞ –ø–æ—Ç–æ—á–Ω–∞ –ø–æ—Å–∞–¥–∞?",
                "current_state",
                "select",
                listOf("–ù–µ –ø—Ä–∞—Ü—é—é/—Å—Ç—É–¥–µ–Ω—Ç/—Å—Ç–∞–∂–µ—Ä", "–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å/—Å–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç", "–ö–µ—Ä—ñ–≤–Ω–∏–∫/–º–µ–Ω–µ–¥–∂–µ—Ä", "–í–ª–∞—Å–Ω–∏–π –±—ñ–∑–Ω–µ—Å")
            ),
            AssessmentQuestion(
                4,
                "–°–∫—ñ–ª—å–∫–∏ —Ä–æ–∫—ñ–≤ –¥–æ—Å–≤—ñ–¥—É —Ä–æ–±–æ—Ç–∏?",
                "current_state",
                "select",
                listOf("–ë–µ–∑ –¥–æ—Å–≤—ñ–¥—É/–¥–æ 1 —Ä–æ–∫—É", "1-5 —Ä–æ–∫—ñ–≤", "5-10 —Ä–æ–∫—ñ–≤", "–ë—ñ–ª—å—à–µ 10 —Ä–æ–∫—ñ–≤")
            ),
            AssessmentQuestion(
                5,
                "–Ø–∫–∞ –≤–∞—à–∞ –ø–æ—Ç–æ—á–Ω–∞ –∑–∞—Ä–ø–ª–∞—Ç–∞? (–≥—Ä–Ω/–º—ñ—Å)",
                "current_state",
                "select",
                listOf("–ù–µ –ø—Ä–∞—Ü—é—é/–¥–æ 20,000", "20,000-50,000", "50,000-100,000", "–ë—ñ–ª—å—à–µ 100,000")
            ),
            AssessmentQuestion(
                6,
                "–í–∞—à—ñ –∫–ª—é—á–æ–≤—ñ –Ω–∞–≤–∏—á–∫–∏? (–æ–±–µ—Ä—ñ—Ç—å –∞–±–æ –Ω–∞–ø–∏—à—ñ—Ç—å —Å–≤–æ—ó)",
                "current_state",
                "select_or_custom",
                listOf("–ö–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è —Ç–∞ —Ä–æ–±–æ—Ç–∞ –∑ –ª—é–¥—å–º–∏", "–ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ —Ç–∞ —Ç–µ—Ö–Ω—ñ—á–Ω—ñ –Ω–∞–≤–∏—á–∫–∏", "–õ—ñ–¥–µ—Ä—Å—Ç–≤–æ —Ç–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è", "–ö—Ä–µ–∞—Ç–∏–≤–Ω—ñ—Å—Ç—å —Ç–∞ —Ç–≤–æ—Ä—á—ñ—Å—Ç—å", "üí° –í–∞—à –≤–∞—Ä—ñ–∞–Ω—Ç")
            ),
            AssessmentQuestion(
                7,
                "–í–∞—à—ñ –≥–æ–ª–æ–≤–Ω—ñ –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è?",
                "current_state",
                "select_or_custom",
                listOf("–©–µ –Ω–µ–º–∞—î –∑–Ω–∞—á–Ω–∏—Ö –¥–æ—Å—è–≥–Ω–µ–Ω—å", "–£—Å–ø—ñ—à–Ω–æ –≤–∏–∫–æ–Ω–∞–≤ —Å–∫–ª–∞–¥–Ω—ñ –ø—Ä–æ–µ–∫—Ç–∏", "–û—Ç—Ä–∏–º–∞–≤ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è/–≤–∏–∑–Ω–∞–Ω–Ω—è", "–ü–æ–±—É–¥—É–≤–∞–≤ –∫–æ–º–∞–Ω–¥—É/–ø–æ–∫—Ä–∞—â–∏–≤ –ø—Ä–æ—Ü–µ—Å–∏", "üí° –í–∞—à –≤–∞—Ä—ñ–∞–Ω—Ç")
            ),
            AssessmentQuestion(
                8,
                "–ù–∞ —è–∫—É –ø–æ—Å–∞–¥—É –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–µ—Ä–µ–π—Ç–∏?",
                "desired_state",
                "select",
                listOf("–°—Ç–∞—Ç–∏ —Å–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç–æ–º/—Ñ–∞—Ö—ñ–≤—Ü–µ–º", "–°—Ç–∞—Ç–∏ –∫–µ—Ä—ñ–≤–Ω–∏–∫–æ–º/–º–µ–Ω–µ–¥–∂–µ—Ä–æ–º", "–í—ñ–¥–∫—Ä–∏—Ç–∏ –≤–ª–∞—Å–Ω–∏–π –±—ñ–∑–Ω–µ—Å", "–ó–º—ñ–Ω–∏—Ç–∏ —Å—Ñ–µ—Ä—É –¥—ñ—è–ª—å–Ω–æ—Å—Ç—ñ")
            ),
            AssessmentQuestion(
                9,
                "–Ø–∫—É –∑–∞—Ä–ø–ª–∞—Ç—É –≤–∏ —Ö–æ—á–µ—Ç–µ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏? (–≥—Ä–Ω/–º—ñ—Å)",
                "desired_state",
                "select",
                listOf("25,000-50,000", "50,000-100,000", "100,000-150,000", "–ë—ñ–ª—å—à–µ 150,000")
            ),
            AssessmentQuestion(
                10,
                "–í —è–∫–æ–º—É —Ç–∏–ø—ñ –∫–æ–º–ø–∞–Ω—ñ—ó —Ö–æ—á–µ—Ç–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏?",
                "desired_state",
                "select",
                listOf("–í–µ–ª–∏–∫–∞ –º—ñ–∂–Ω–∞—Ä–æ–¥–Ω–∞ –∫–æ—Ä–ø–æ—Ä–∞—Ü—ñ—è", "–°–µ—Ä–µ–¥–Ω—ñ–π/–º–∞–ª–∏–π –±—ñ–∑–Ω–µ—Å/—Å—Ç–∞—Ä—Ç–∞–ø", "–î–µ—Ä–∂–∞–≤–Ω–∞ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è", "–í–ª–∞—Å–Ω–∏–π –±—ñ–∑–Ω–µ—Å/—Ñ—Ä—ñ–ª–∞–Ω—Å")
            ),
            AssessmentQuestion(
                11,
                "–©–æ –Ω–∞–π–±—ñ–ª—å—à–µ –∑–∞–≤–∞–∂–∞—î –≤–∞–º –¥–æ—Å—è–≥—Ç–∏ –∫–∞—Ä'—î—Ä–Ω–æ—ó –º–µ—Ç–∏?",
                "barriers",
                "select_or_custom",
                listOf("–ë—Ä–∞–∫ –∑–Ω–∞–Ω—å/–Ω–∞–≤–∏—á–æ–∫", "–ë—Ä–∞–∫ –¥–æ—Å–≤—ñ–¥—É", "–ë—Ä–∞–∫ —á–∞—Å—É", "–ë—Ä–∞–∫ –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ", "üí° –í–∞—à –≤–∞—Ä—ñ–∞–Ω—Ç")
            ),
            AssessmentQuestion(
                12,
                "–©–æ –¥–ª—è –≤–∞—Å –Ω–∞–π–≤–∞–∂–ª–∏–≤—ñ—à–µ –≤ —Ä–æ–±–æ—Ç—ñ?",
                "desired_state",
                "select",
                listOf("–í–∏—Å–æ–∫–∞ –∑–∞—Ä–ø–ª–∞—Ç–∞", "–†–æ–∑–≤–∏—Ç–æ–∫ —Ç–∞ –Ω–∞–≤—á–∞–Ω–Ω—è", "Work-life balance", "–¶—ñ–∫–∞–≤—ñ –∑–∞–¥–∞—á—ñ —Ç–∞ –∫–æ–º–∞–Ω–¥–∞")
            ),
            AssessmentQuestion(
                13,
                "–ß–∏ —î —É –≤–∞—Å —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏/–∫—É—Ä—Å–∏?",
                "additional",
                "select",
                listOf("–ù–µ–º–∞—î", "1-3 –∫—É—Ä—Å–∏ –ø—Ä–æ–π–¥–µ–Ω–æ", "–ë—ñ–ª—å—à–µ 3 –∫—É—Ä—Å—ñ–≤", "–ú—ñ–∂–Ω–∞—Ä–æ–¥–Ω—ñ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏")
            ),
            AssessmentQuestion(
                14,
                "–Ø–∫—ñ —É –≤–∞—Å —Ö–æ–±—ñ/—ñ–Ω—Ç–µ—Ä–µ—Å–∏?",
                "additional",
                "select_or_custom",
                listOf("–°–ø–æ—Ä—Ç —Ç–∞ –∞–∫—Ç–∏–≤–Ω–∏–π –≤—ñ–¥–ø–æ—á–∏–Ω–æ–∫", "–ß–∏—Ç–∞–Ω–Ω—è —Ç–∞ —Å–∞–º–æ–æ—Å–≤—ñ—Ç–∞", "–¢–≤–æ—Ä—á—ñ—Å—Ç—å —Ç–∞ –º–∏—Å—Ç–µ—Ü—Ç–≤–æ", "–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó —Ç–∞ –±—ñ–∑–Ω–µ—Å", "üí° –í–∞—à –≤–∞—Ä—ñ–∞–Ω—Ç")
            ),
            AssessmentQuestion(
                15,
                "–©–æ –≤–∞—Å –Ω–∞–π–±—ñ–ª—å—à–µ –º–æ—Ç–∏–≤—É—î –≤ –∫–∞—Ä'—î—Ä—ñ?",
                "additional",
                "select",
                listOf("–§—ñ–Ω–∞–Ω—Å–æ–≤–∞ –Ω–µ–∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å", "–ü—Ä–æ—Ñ–µ—Å—ñ–π–Ω–µ –≤–∏–∑–Ω–∞–Ω–Ω—è", "–î–æ–ø–æ–º–æ–≥–∞ –ª—é–¥—è–º/—Å—É—Å–ø—ñ–ª—å—Å—Ç–≤—É", "–°–≤–æ–±–æ–¥–∞ —Ç–∞ –≥–Ω—É—á–∫—ñ—Å—Ç—å")
            )
        )
    }

    suspend fun analyzeCareerGap(
        answers: Map<Int, String>,
        questions: List<AssessmentQuestion>
    ): String {
        val answersText = buildString {
            questions.forEach { question ->
                val answer = answers[question.id] ?: "–ù–µ–º–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ"
                appendLine("${question.text}")
                appendLine("–í—ñ–¥–ø–æ–≤—ñ–¥—å: $answer")
                appendLine()
            }
        }

        // –í–∏—Ç—è–≥—É—î–º–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É
        val currentSalary = answers[5] ?: ""
        val desiredSalary = answers[9] ?: ""
        val currentPosition = answers[3] ?: ""
        val desiredPosition = answers[8] ?: ""
        val experience = answers[4] ?: ""
        val barrier = answers[11] ?: ""
        val education = answers[2] ?: ""
        val skills = answers[6] ?: ""
        val achievements = answers[7] ?: ""
        val certificates = answers[13] ?: ""

        val prompt = """
–¢–∏ - –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π career counselor –∑ 20+ —Ä–æ–∫–∞–º–∏ –¥–æ—Å–≤—ñ–¥—É. –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ —Ç–∞ —Å—Ç–≤–æ—Ä–∏ –ü–ï–†–°–û–ù–ê–õ–Ü–ó–û–í–ê–ù–ò–ô Gap Analysis.

–í–Ü–î–ü–û–í–Ü–î–Ü –ö–ê–ù–î–ò–î–ê–¢–ê:
$answersText

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
–ö–†–ò–¢–ò–ß–ù–û –í–ê–ñ–õ–ò–í–û: –¢–û–ß–ù–ò–ô –†–û–ó–†–ê–•–£–ù–û–ö MATCH SCORE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

–†–æ–∑—Ä–∞—Ö—É–π Match Score –∑–∞ —Ñ–æ—Ä–º—É–ª–æ—é (–∫–æ–∂–µ–Ω —Ñ–∞–∫—Ç–æ—Ä –≤—ñ–¥ 0 –¥–æ 20 –±–∞–ª—ñ–≤):

1. –ü–û–ó–ò–¶–Ü–ô–ù–ò–ô GAP (0-20 –±–∞–ª—ñ–≤):
   - –ü–æ—Ç–æ—á–Ω–∞: "$currentPosition" ‚Üí –ë–∞–∂–∞–Ω–∞: "$desiredPosition"
   - –¢–∞ —Å–∞–º–∞ –ø–æ–∑–∏—Ü—ñ—è = 20 –±–∞–ª—ñ–≤
   - –û–¥–Ω–∞ —Å—Ç—É–ø—ñ–Ω—å –≤–≥–æ—Ä—É (—Å–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç‚Üí–∫–µ—Ä—ñ–≤–Ω–∏–∫) = 14 –±–∞–ª—ñ–≤
   - –î–≤—ñ —Å—Ç—É–ø–µ–Ω—ñ –≤–≥–æ—Ä—É (—Å—Ç—É–¥–µ–Ω—Ç‚Üí–∫–µ—Ä—ñ–≤–Ω–∏–∫) = 8 –±–∞–ª—ñ–≤
   - –ö–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–∞ –∑–º—ñ–Ω–∞ (–±—É–¥—å-—â–æ‚Üí–≤–ª–∞—Å–Ω–∏–π –±—ñ–∑–Ω–µ—Å) = 6 –±–∞–ª—ñ–≤
   - –ü–æ–≤–Ω–∞ –∑–º—ñ–Ω–∞ —Å—Ñ–µ—Ä–∏ = 4 –±–∞–ª–∏

2. –î–û–°–í–Ü–î (0-20 –±–∞–ª—ñ–≤):
   - –î–æ—Å–≤—ñ–¥: "$experience"
   - –ë—ñ–ª—å—à–µ 10 —Ä–æ–∫—ñ–≤ = 20 –±–∞–ª—ñ–≤
   - 5-10 —Ä–æ–∫—ñ–≤ = 16 –±–∞–ª—ñ–≤
   - 1-5 —Ä–æ–∫—ñ–≤ = 12 –±–∞–ª—ñ–≤
   - –î–æ 1 —Ä–æ–∫—É = 6 –±–∞–ª—ñ–≤

3. –û–°–í–Ü–¢–ê + –°–ï–†–¢–ò–§–Ü–ö–ê–¢–ò (0-20 –±–∞–ª—ñ–≤):
   - –û—Å–≤—ñ—Ç–∞: "$education", –°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏: "$certificates"
   - –í–∏—â–∞ + –º—ñ–∂–Ω–∞—Ä–æ–¥–Ω—ñ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏ = 20 –±–∞–ª—ñ–≤
   - –í–∏—â–∞ + –∫—É—Ä—Å–∏ = 16 –±–∞–ª—ñ–≤
   - –í–∏—â–∞ –±–µ–∑ –∫—É—Ä—Å—ñ–≤ = 12 –±–∞–ª—ñ–≤
   - –ù–µ–ø–æ–≤–Ω–∞ –≤–∏—â–∞ + –∫—É—Ä—Å–∏ = 10 –±–∞–ª—ñ–≤
   - –°–µ—Ä–µ–¥–Ω—è = 6 –±–∞–ª—ñ–≤

4. –ù–ê–í–ò–ß–ö–ò + –î–û–°–Ø–ì–ù–ï–ù–ù–Ø (0-20 –±–∞–ª—ñ–≤):
   - –ù–∞–≤–∏—á–∫–∏: "$skills", –î–æ—Å—è–≥–Ω–µ–Ω–Ω—è: "$achievements"
   - –†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ñ –Ω–∞–≤–∏—á–∫–∏ + –∑–Ω–∞—á–Ω—ñ –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è = 20 –±–∞–ª—ñ–≤
   - –†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ñ –Ω–∞–≤–∏—á–∫–∏ + –¥–µ—è–∫—ñ –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è = 14 –±–∞–ª—ñ–≤
   - –ë–∞–∑–æ–≤—ñ –Ω–∞–≤–∏—á–∫–∏ = 10 –±–∞–ª—ñ–≤
   - –ù–µ–º–∞—î –¥–æ—Å—è–≥–Ω–µ–Ω—å = 6 –±–∞–ª—ñ–≤

5. –§–Ü–ù–ê–ù–°–û–í–ò–ô GAP (0-20 –±–∞–ª—ñ–≤):
   - –ü–æ—Ç–æ—á–Ω–∞ –ó–ü: "$currentSalary" ‚Üí –ë–∞–∂–∞–Ω–∞: "$desiredSalary"
   - –†—ñ–∑–Ω–∏—Ü—è –¥–æ 30% = 20 –±–∞–ª—ñ–≤
   - –†—ñ–∑–Ω–∏—Ü—è 30-50% = 16 –±–∞–ª—ñ–≤
   - –†—ñ–∑–Ω–∏—Ü—è 50-100% = 12 –±–∞–ª—ñ–≤
   - –†—ñ–∑–Ω–∏—Ü—è 100-200% = 8 –±–∞–ª—ñ–≤
   - –†—ñ–∑–Ω–∏—Ü—è –±—ñ–ª—å—à–µ 200% = 4 –±–∞–ª–∏

–ü–Ü–î–†–ê–•–£–ô –¢–û–ß–ù–û:
–§–∞–∫—Ç–æ—Ä 1: [X] –±–∞–ª—ñ–≤ (–ø–æ—è—Å–Ω–µ–Ω–Ω—è)
–§–∞–∫—Ç–æ—Ä 2: [X] –±–∞–ª—ñ–≤ (–ø–æ—è—Å–Ω–µ–Ω–Ω—è)
–§–∞–∫—Ç–æ—Ä 3: [X] –±–∞–ª—ñ–≤ (–ø–æ—è—Å–Ω–µ–Ω–Ω—è)
–§–∞–∫—Ç–æ—Ä 4: [X] –±–∞–ª—ñ–≤ (–ø–æ—è—Å–Ω–µ–Ω–Ω—è)
–§–∞–∫—Ç–æ—Ä 5: [X] –±–∞–ª—ñ–≤ (–ø–æ—è—Å–Ω–µ–Ω–Ω—è)
–°–£–ú–ê: [XX] –±–∞–ª—ñ–≤ –∑ 100 = [XX]%

–í–ê–ñ–õ–ò–í–û: 
- –ù–ï –æ–∫—Ä—É–≥–ª—è–π –¥–æ 5 –∞–±–æ 10! 
- Match Score –º–∞—î –±—É—Ç–∏ –¢–û–ß–ù–ò–ú —á–∏—Å–ª–æ–º (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: 47%, 63%, 71%, 82%)
- –ü–æ–∫–∞–∑—É–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –∫–æ–∂–Ω–æ–≥–æ —Ñ–∞–∫—Ç–æ—Ä—É

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

–§–û–†–ú–ê–¢ –í–Ü–î–ü–û–í–Ü–î–Ü:

üìä CAREER GAP ANALYSIS

üéØ Match Score: [–¢–û–ß–ù–ï –ß–ò–°–õ–û]%

üìà –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫:
- –ü–æ–∑–∏—Ü—ñ–π–Ω–∏–π gap: [X]/20 - [–ø–æ—è—Å–Ω–µ–Ω–Ω—è]
- –î–æ—Å–≤—ñ–¥: [X]/20 - [–ø–æ—è—Å–Ω–µ–Ω–Ω—è]
- –û—Å–≤—ñ—Ç–∞: [X]/20 - [–ø–æ—è—Å–Ω–µ–Ω–Ω—è]
- –ù–∞–≤–∏—á–∫–∏: [X]/20 - [–ø–æ—è—Å–Ω–µ–Ω–Ω—è]
- –§—ñ–Ω–∞–Ω—Å–æ–≤–∏–π gap: [X]/20 - [–ø–æ—è—Å–Ω–µ–Ω–Ω—è]
- –†–∞–∑–æ–º: [XX]/100 = [XX]%

üìç –ü–æ—Ç–æ—á–Ω–∏–π —Ä—ñ–≤–µ–Ω—å: $currentPosition
üéØ –ë–∞–∂–∞–Ω–∏–π —Ä—ñ–≤–µ–Ω—å: $desiredPosition

üí™ –°–ò–õ–¨–ù–Ü –°–¢–û–†–û–ù–ò:
- [—Å—Ç–æ—Ä–æ–Ω–∞ 1 - –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –∑ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π]
- [—Å—Ç–æ—Ä–æ–Ω–∞ 2]
- [—Å—Ç–æ—Ä–æ–Ω–∞ 3]

üìà –©–û –ü–û–¢–†–Ü–ë–ù–û –†–û–ó–í–ò–ù–£–¢–ò:
- [gap 1 - –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –±–∞—Ä'—î—Ä—É]
- [gap 2]
- [gap 3]

üí∞ –û–¶–Ü–ù–ö–ê –ó–ê–†–ü–õ–ê–¢–ò: [–†–µ–∞–ª—ñ—Å—Ç–∏—á–Ω–∞/–ê–º–±—ñ—Ç–Ω–∞/–î—É–∂–µ –∞–º–±—ñ—Ç–Ω–∞]
$currentSalary ‚Üí $desiredSalary

‚è∞ –ß–ê–° –î–û –ú–ï–¢–ò: [–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π —Ç–µ—Ä–º—ñ–Ω]

üöß –Ø–ö –ü–û–î–û–õ–ê–¢–ò –ì–û–õ–û–í–ù–ò–ô –ë–ê–†'–Ñ–† "$barrier":
[2-3 –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –ø–æ—Ä–∞–¥–∏]

–ë—É–¥—å –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û —Ç–æ—á–Ω–∏–º —É —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∞—Ö!
""".trimIndent()

        return try {
            val response = assessmentModel.generateContent(prompt)
            response.text ?: "–ù–µ –≤–¥–∞–ª–æ—Å—å –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å"
        } catch (e: Exception) {
            "–ü–æ–º–∏–ª–∫–∞ –∞–Ω–∞–ª—ñ–∑—É: ${e.message}"
        }
    }

    suspend fun generateActionPlan(
        answers: Map<Int, String>,
        questions: List<AssessmentQuestion>,
        gapAnalysis: String
    ): String {
        val answersText = buildString {
            questions.forEach { question ->
                val answer = answers[question.id] ?: "–ù–µ–º–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ"
                appendLine("${question.text}: $answer")
            }
        }

        val barrier = answers[11] ?: "–ù–µ –≤–∫–∞–∑–∞–Ω–æ"
        val desiredPosition = answers[8] ?: ""
        val skills = answers[6] ?: ""

        val prompt = """
–¢–∏ - –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π career counselor. –ù–∞ –æ—Å–Ω–æ–≤—ñ –ø—Ä–æ—Ñ—ñ–ª—é —Ç–∞ Gap Analysis —Å—Ç–≤–æ—Ä–∏ –ö–û–ù–ö–†–ï–¢–ù–ò–ô –ø–ª–∞–Ω –¥—ñ–π –∑ –†–Ü–í–ù–û 10 –ö–†–û–ö–Ü–í.

–ü–†–û–§–Ü–õ–¨:
$answersText

GAP ANALYSIS:
$gapAnalysis

–ì–û–õ–û–í–ù–ò–ô –ë–ê–†'–Ñ–† –ö–û–†–ò–°–¢–£–í–ê–ß–ê: $barrier
–ë–ê–ñ–ê–ù–ê –ü–û–ó–ò–¶–Ü–Ø: $desiredPosition
–ü–û–¢–û–ß–ù–Ü –ù–ê–í–ò–ß–ö–ò: $skills

–°–¢–í–û–†–ò –î–ï–¢–ê–õ–¨–ù–ò–ô ACTION PLAN –∑ –†–Ü–í–ù–û 10 –ö–†–û–ö–Ü–í:

–í–ê–ñ–õ–ò–í–û:
- –ö—Ä–æ–∫–∏ –º–∞—é—Ç—å –±—É—Ç–∏ –ü–ï–†–°–û–ù–ê–õ–Ü–ó–û–í–ê–ù–Ü –ø—ñ–¥ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- –ü–µ—Ä—à—ñ 2-3 –∫—Ä–æ–∫–∏ –º–∞—é—Ç—å –¥–æ–ø–æ–º–æ–≥—Ç–∏ –ø–æ–¥–æ–ª–∞—Ç–∏ –±–∞—Ä'—î—Ä "$barrier"
- –ö–æ–∂–µ–Ω –∫—Ä–æ–∫ –≤–µ–¥–µ –¥–æ –º–µ—Ç–∏ "$desiredPosition"
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π —ñ—Å–Ω—É—é—á—ñ –Ω–∞–≤–∏—á–∫–∏ "$skills"
- –†–Ü–í–ù–û 10 –∫—Ä–æ–∫—ñ–≤ (–Ω–µ –±—ñ–ª—å—à–µ, –Ω–µ –º–µ–Ω—à–µ)
- –ö–æ–∂–µ–Ω –∫—Ä–æ–∫ –°–¢–ò–°–õ–ò–ô —ñ –ö–û–ù–ö–†–ï–¢–ù–ò–ô
- –†–µ–∞–ª—ñ—Å—Ç–∏—á–Ω—ñ —Ç–µ—Ä–º—ñ–Ω–∏ –¥–ª—è –£–∫—Ä–∞—ó–Ω–∏
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏ (–Ω–∞–∑–≤–∏ –∫—É—Ä—Å—ñ–≤, –ø–ª–∞—Ç—Ñ–æ—Ä–º, –∫–Ω–∏–≥)

–§–û–†–ú–ê–¢ –í–Ü–î–ü–û–í–Ü–î–Ü (–°–¢–†–û–ì–û):

üéØ ACTION PLAN

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üìç –ö–†–û–ö 1: [–ù–∞–∑–≤–∞ –º–∞–∫—Å–∏–º—É–º 5 —Å–ª—ñ–≤]
‚è∞ –ß–∞—Å: [—Ç–µ—Ä–º—ñ–Ω]
üî• –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç: [–ö—Ä–∏—Ç–∏—á–Ω–æ/–í–∏—Å–æ–∫–∏–π/–°–µ—Ä–µ–¥–Ω—ñ–π]

[–û–ø–∏—Å - –º–∞–∫—Å–∏–º—É–º 2-3 —Ä–µ—á–µ–Ω–Ω—è –∑ –ö–û–ù–ö–†–ï–¢–ù–ò–ú–ò –¥—ñ—è–º–∏]
üí° –†–µ—Å—É—Ä—Å–∏: [–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –Ω–∞–∑–≤–∏ –∫—É—Ä—Å—ñ–≤/–∫–Ω–∏–≥/–ø–ª–∞—Ç—Ñ–æ—Ä–º]

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üìç –ö–†–û–ö 2: [–ù–∞–∑–≤–∞]
‚è∞ –ß–∞—Å: [—Ç–µ—Ä–º—ñ–Ω]
üî• –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç: [–ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç]

[–û–ø–∏—Å]
üí° –†–µ—Å—É—Ä—Å–∏: [—Ä–µ—Å—É—Ä—Å–∏]

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

[... –ø—Ä–æ–¥–æ–≤–∂—É–π –¥–æ –∫—Ä–æ–∫—É 10]

üìç –ö–†–û–ö 10: [–ù–∞–∑–≤–∞]
‚è∞ –ß–∞—Å: [—Ç–µ—Ä–º—ñ–Ω]
üî• –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç: [–ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç]

[–û–ø–∏—Å]
üí° –†–µ—Å—É—Ä—Å–∏: [—Ä–µ—Å—É—Ä—Å–∏]

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üéØ –ó–ê–ì–ê–õ–¨–ù–ò–ô –ß–ê–° –î–û –ú–ï–¢–ò: [—Å—É–º–∞ –≤—Å—ñ—Ö –∫—Ä–æ–∫—ñ–≤]

–ë–ï–ó –î–û–î–ê–¢–ö–û–í–û–ì–û –¢–ï–ö–°–¢–£! –¢–Ü–õ–¨–ö–ò 10 –ö–†–û–ö–Ü–í!
""".trimIndent()

        return try {
            val response = assessmentModel.generateContent(prompt)
            response.text ?: "–ù–µ –≤–¥–∞–ª–æ—Å—å –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –ø–ª–∞–Ω –¥—ñ–π"
        } catch (e: Exception) {
            "–ü–æ–º–∏–ª–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø–ª–∞–Ω—É: ${e.message}\n\n–°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑."
        }
    }
}

data class AssessmentQuestion(
    val id: Int,
    val text: String,
    val category: String,
    val inputType: String,
    val options: List<String>?
)